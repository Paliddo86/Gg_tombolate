<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cartelle Tombola â€“ Offline v3 (iOS fix)</title>

<style>
body { font-family: Arial, sans-serif; margin: 12px; }
.controls { margin-bottom: 12px; }
input, button { font-size: 15px; padding: 6px 8px; margin: 2px; }

.page {
  page-break-after: always;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

.cartella { border: 2px solid #000; padding: 4px; }
.title { text-align: center; font-size: 12px; font-weight: bold; }
.number { text-align: center; font-size: 11px; margin-bottom: 2px; }

table { width: 100%; border-collapse: collapse; }
td {
  border: 1px solid #000;
  height: 34px;
  text-align: center;
  font-weight: bold;
  font-size: 14px;
}

.footer { font-size: 9px; text-align: center; line-height: 1; margin-top: 2px; }

@media print {
  .controls { display: none; }
  body { margin: 0; }
}
</style>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffffff">
</head>


<body>

<div class="controls">
  Titolo:
  <input id="title" value="Tombolata Gruppo Giovani">
  Cartelle:
  <input id="count" type="number" value="20" min="1">
  Inizio:
  <input id="first" type="number" value="1">
  <button id="generateBtn" type="button">Genera</button>
</div>

<div id="output"></div>

<script>
(function () {

function shuffle(a) {
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    const t = a[i]; a[i] = a[j]; a[j] = t;
  }
  return a;
}

function generateCartella() {
  const columns = [
    [1,2,3,4,5,6,7,8,9],
    [10,11,12,13,14,15,16,17,18,19],
    [20,21,22,23,24,25,26,27,28,29],
    [30,31,32,33,34,35,36,37,38,39],
    [40,41,42,43,44,45,46,47,48,49],
    [50,51,52,53,54,55,56,57,58,59],
    [60,61,62,63,64,65,66,67,68,69],
    [70,71,72,73,74,75,76,77,78,79],
    [80,81,82,83,84,85,86,87,88,89,90]
  ];

  const grid = [
    ["","","","","","","","",""],
    ["","","","","","","","",""],
    ["","","","","","","","",""]
  ];

  const colCounts = [1,1,1,1,1,1,1,1,1];
  let extra = 6;
  while (extra > 0) {
    const c = Math.floor(Math.random()*9);
    if (colCounts[c] < 3) { colCounts[c]++; extra--; }
  }

  for (let c = 0; c < 9; c++) {
    const nums = shuffle(columns[c].slice()).slice(0, colCounts[c]).sort((a,b)=>a-b);
    const rows = shuffle([0,1,2]).slice(0, colCounts[c]);
    for (let i = 0; i < rows.length; i++) {
      grid[rows[i]][c] = nums[i];
    }
  }

  for (let r = 0; r < 3; r++) {
    let filled = grid[r].filter(v=>v!=="").length;
    while (filled > 5) {
      const c = Math.floor(Math.random()*9);
      if (grid[r][c] !== "") {
        grid[r][c] = "";
        filled--;
      }
    }
  }

  return grid;
}

function generate() {
  const out = document.getElementById("output");
  out.innerHTML = "";

  const count = parseInt(document.getElementById("count").value, 10);
  const first = parseInt(document.getElementById("first").value, 10);
  const title = document.getElementById("title").value;

  for (let i = 0; i < count; i += 4) {
    const page = document.createElement("div");
    page.className = "page";

    for (let j = 0; j < 4 && i+j < count; j++) {
      const cart = generateCartella();
      const div = document.createElement("div");
      div.className = "cartella";

      let html = "";
      html += '<div class="title">' + title + '</div>';
      html += '<div class="number">' + (first + i + j) + '</div>';
      html += '<table>';
      for (let r = 0; r < 3; r++) {
        html += '<tr>';
        for (let c = 0; c < 9; c++) {
          html += '<td>' + (cart[r][c] || "") + '</td>';
        }
        html += '</tr>';
      }
      html += '</table>';
      html += '<div class="footer">Cartella generata offline</div>';

      div.innerHTML = html;
      page.appendChild(div);
    }
    out.appendChild(page);
  }
}

document.getElementById("generateBtn").addEventListener("click", generate);

})();
</script>


<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", function() {
    navigator.serviceWorker.register("sw.js");
  });
}
</script>
</body>

</html>
