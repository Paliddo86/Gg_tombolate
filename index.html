<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generatore Cartelle - Gruppo Giovani V. Nigro</title>
    <style>
        :root { --border-color: #000; }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        
        /* Controlli UI */
        .no-print { 
            background: #fff; padding: 20px; border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px; text-align: center;
        }
        input { padding: 8px; width: 60px; border: 1px solid #ccc; border-radius: 4px; }
        button { 
            padding: 8px 20px; cursor: pointer; background: #27ae60; 
            color: white; border: none; border-radius: 4px; font-weight: bold; 
        }
        button:hover { background: #219150; }

        /* Layout Cartella simile al PDF */
        .cartelle-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
        
        .cartella {
            width: 650px; background: #fff; border: 2px solid var(--border-color);
            padding: 15px; position: relative; box-sizing: border-box;
            page-break-inside: avoid; margin-bottom: 10px;
        }

        .header-titolo {
            text-align: center; font-weight: bold; font-size: 18px;
            margin-bottom: 2px; text-transform: uppercase;
        }
        .header-sub {
            text-align: center; font-size: 10px; color: #666;
            margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;
        }

        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        td {
            border: 1.5px solid var(--border-color); height: 55px;
            text-align: center; font-size: 28px; font-weight: 800; width: 11.11%;
        }
        .empty { background-color: #fafafa; }

        @media print {
            .no-print { display: none; }
            body { background: #fff; margin: 0; }
            .cartella { margin: 10px auto; border-width: 1px; }
            .cartelle-container { display: block; }
        }
    </style>
</head>
<body>

<div class="no-print">
    <h1>Generatore Cartelle Tombola</h1>
    <p>Inserisci il numero di cartelle che vuoi creare per il <strong>Gruppo Giovani V. Nigro</strong>:</p>
    <input type="number" id="qty" value="6" min="1">
    <button onclick="generate()">Genera Cartelle</button>
    <button onclick="window.print()" style="background:#2980b9">Stampa / Salva PDF</button>
</div>

<div id="main-container" class="cartelle-container"></div>

<script>
function generate() {
    const container = document.getElementById('main-container');
    const qty = document.getElementById('qty').value;
    container.innerHTML = '';

    for (let i = 0; i < qty; i++) {
        const matrix = createTombolaMatrix();
        renderCartella(matrix, i + 1, container);
    }
}

function createTombolaMatrix() {
    // Inizializza matrice 3x9 vuota
    let grid = Array.from({ length: 3 }, () => Array(9).fill(null));
    
    // Definisci i range delle decine
    let columns = Array.from({ length: 9 }, (_, i) => {
        let min = i === 0 ? 1 : i * 10;
        let max = i === 8 ? 90 : i * 10 + 9;
        let nums = [];
        for (let n = min; n <= max; n++) nums.push(n);
        return nums.sort(() => Math.random() - 0.5);
    });

    // Per ogni riga, scegliamo 5 colonne casuali
    for (let r = 0; r < 3; r++) {
        let selectedCols = [];
        while(selectedCols.length < 5) {
            let c = Math.floor(Math.random() * 9);
            if (!selectedCols.includes(c)) selectedCols.push(c);
        }
        selectedCols.forEach(c => {
            grid[r][c] = columns[c].pop();
        });
    }

    // Validazione: assicuriamoci che non ci siano colonne vuote (raro ma possibile)
    // E ordiniamo i numeri per colonna (regola ufficiale)
    for (let c = 0; c < 9; c++) {
        let colValues = [];
        for (let r = 0; r < 3; r++) {
            if (grid[r][c] !== null) colValues.push(grid[r][c]);
        }
        colValues.sort((a, b) => a - b);
        let idx = 0;
        for (let r = 0; r < 3; r++) {
            if (grid[r][c] !== null) grid[r][c] = colValues[idx++];
        }
    }
    return grid;
}

function renderCartella(matrix, id, target) {
    const cardDiv = document.createElement('div');
    cardDiv.className = 'cartella';
    
    let tableHtml = `
        <div class="header-titolo">Tombola Gruppo Giovani V. Nigro Seconda mano</div>
        <div class="header-sub">Cartella #${id} - Generata dinamicamente</div>
        <table>`;
    
    matrix.forEach(row => {
        tableHtml += '<tr>';
        row.forEach(cell => {
            tableHtml += cell ? `<td>${cell}</td>` : '<td class="empty"></td>';
        });
        tableHtml += '</tr>';
    });
    
    tableHtml += '</table>';
    cardDiv.innerHTML = tableHtml;
    target.appendChild(cardDiv);
}

// Genera all'avvio
generate();
</script>

</body>
</html>
